# SPEC-VET-001 인수 기준

## 메타데이터

| 항목 | 내용 |
|------|------|
| SPEC ID | SPEC-VET-001 |
| 관련 SPEC | spec.md |

---

## 1. 모듈 1: Excel 업로드 및 환자 데이터 관리

### AC-101: Excel 파일 업로드 및 파싱

**Given** 사용자가 /patients 페이지에 접속해 있을 때
**When** 30개 월별 시트가 포함된 .xlsx 파일을 드래그 앤 드롭하면
**Then** 시스템은 10초 이내에 파싱을 완료하고, 시트별 환자 수와 경고 건수를 미리보기로 표시한다

**Given** Excel 파일이 파싱된 상태에서
**When** "복사용" 시트가 포함되어 있으면
**Then** 시스템은 해당 시트를 자동으로 제외하고 YYYY-MM 형식의 시트만 처리한다

### AC-102: 데이터 유효성 검증

**Given** Excel 파싱이 완료되었을 때
**When** Row 10의 차트번호가 비어있으면
**Then** 시스템은 "Row 10: 차트번호 누락" 경고를 미리보기에 표시한다

**Given** 필수 필드(차트번호, 내원날짜, 보호자 성함, 동물 이름) 중 하나라도 누락된 행이 있을 때
**When** 사용자가 가져오기를 실행하면
**Then** 시스템은 해당 행을 건너뛰고 경고 로그에 기록한다

### AC-103: 중복 데이터 처리

**Given** DB에 차트번호 "12706", 내원날짜 "2026-02-10" 환자가 이미 존재할 때
**When** 동일한 차트번호와 내원날짜의 데이터가 포함된 Excel을 업로드하면
**Then** 시스템은 중복 건수를 표시하고 "건너뛰기/덮어쓰기" 선택지를 제공한다

**Given** 사용자가 "건너뛰기"를 선택했을 때
**When** 가져오기를 실행하면
**Then** 중복 데이터는 무시하고 신규 데이터만 저장한다

### AC-104: 환자 목록 및 검색

**Given** 환자 데이터가 100건 이상 존재할 때
**When** 검색바에 "겨울이"를 입력하면
**Then** 동물이름이 "겨울이"인 환자 목록만 1초 이내에 표시된다

**Given** 환자 목록 페이지에서
**When** 월 필터를 "2026-02"로 선택하면
**Then** 해당 월의 환자만 필터링되어 표시된다

### AC-105: 환자 CRUD

**Given** 사용자가 환자 추가 폼을 작성했을 때
**When** 필수 필드를 모두 입력하고 저장 버튼을 클릭하면
**Then** 새 환자가 DB에 저장되고 목록에 즉시 반영된다

**Given** 기존 환자 정보를 수정한 뒤
**When** 저장 버튼을 클릭하면
**Then** 변경사항이 DB에 반영되고 관련 통계가 재계산된다

### AC-106: 건강검진 프로모션 데이터

**Given** Excel 파일에 건강검진 영역(Row 137~176) 데이터가 포함되어 있을 때
**When** 가져오기를 실행하면
**Then** 강아지/고양이 검진 데이터가 health_checkups 테이블에 별도 저장된다

---

## 2. 모듈 2: 메시지 자동 생성

### AC-201: 진료 후 메시지 생성

**Given** 환자 "겨울이" (보호자 김OO, 수납 450,000원)를 선택한 상태에서
**When** "진료 후" 메시지 유형을 선택하고 약 복용일수=7, 복용횟수=2, 안약보관=냉장, 안약횟수=2, 재진일=2026-02-17, 재진시간=AM 10:00을 입력하면
**Then** 미리보기에 "겨울이"가 자동 삽입되고, 입력한 변수가 반영된 완성 메시지가 실시간 표시된다

### AC-202: 퇴원 후 메시지 생성

**Given** 환자를 선택하고 "퇴원 후" 유형을 선택했을 때
**When** 변수를 입력하면
**Then** 퇴원 후 템플릿 기반의 메시지가 생성되고, 공통 푸터가 자동 첨부된다

### AC-203: 재진 메시지 생성

**Given** 환자 "겨울이"를 선택하고 "재진 D-1" 유형을 선택했을 때
**When** 재진시간=14:00을 입력하면
**Then** 재진일(환자 데이터에서 자동), 동물이름(자동), 재진시간(14:00)이 포함된 메시지가 생성된다

### AC-204: 안부 메시지 자동 분류

**Given** 수납금액이 450,000원인 환자를 선택했을 때
**When** "안부 메시지"를 요청하면
**Then** 시스템은 자동으로 "30만원 이상" 카테고리를 선택하고, 진료일 기준 경과 기간에 따라 3개월 또는 6개월 템플릿을 제안한다

**Given** 수납금액이 180,000원인 환자를 선택했을 때
**When** "안부 메시지"를 요청하면
**Then** 시스템은 자동으로 "30만원 미만" 카테고리를 선택한다

### AC-205: 클립보드 복사

**Given** 메시지가 생성되어 미리보기에 표시된 상태에서
**When** "클립보드에 복사" 버튼을 클릭하면
**Then** 메시지 전체 내용(본문 + 푸터)이 클립보드에 복사되고, "복사 완료" 토스트 알림이 표시된다

### AC-206: 공통 푸터

**Given** 어떤 유형의 메시지든 생성할 때
**When** 메시지가 완성되면
**Then** 전화번호(032-423-7588, 010-8661-7589), 진료시간, 카카오톡 채널 링크가 포함된 푸터가 자동 첨부된다

### AC-207: 메시지 로그 기록

**Given** 메시지를 생성하고 클립보드에 복사했을 때
**When** 복사가 완료되면
**Then** message_logs 테이블에 환자ID, 템플릿유형, 메시지내용, 복사시각이 기록된다

---

## 3. 모듈 3: 리마인더 스케줄링

### AC-301: 재진 리마인더 자동 생성

**Given** 재진일이 2026-02-20으로 설정된 환자를 등록했을 때
**When** 환자 데이터가 저장되면
**Then** due_date=2026-02-19(D-1), type=revisit_d1인 리마인더가 자동 생성된다

### AC-302: 안부 리마인더 자동 생성 (30만원 이상)

**Given** 내원날짜 2026-02-10, 수납금액 450,000원인 환자를 등록했을 때
**When** 환자 데이터가 저장되면
**Then** due_date=2026-05-10(3개월), type=followup_3m, message_template_type=followup_high_3m인 리마인더와
due_date=2026-08-10(6개월), type=followup_6m, message_template_type=followup_high_6m인 리마인더가 자동 생성된다

### AC-303: 안부 리마인더 자동 생성 (30만원 미만)

**Given** 내원날짜 2026-02-10, 수납금액 180,000원인 환자를 등록했을 때
**When** 환자 데이터가 저장되면
**Then** message_template_type이 followup_low_3m, followup_low_6m으로 설정된 리마인더가 생성된다

### AC-304: 대시보드 오늘의 할 일

**Given** 오늘 날짜가 2026-02-19이고, due_date=2026-02-19인 리마인더가 3건 존재할 때
**When** 대시보드(/)에 접속하면
**Then** 3건의 리마인더가 유형별(재진/3개월안부/6개월안부)로 그룹화되어 표시된다

### AC-305: 리마인더 완료 처리

**Given** 대시보드에 표시된 리마인더에서
**When** [완료] 버튼을 클릭하면
**Then** 해당 리마인더의 status가 completed로 변경되고, completed_at에 현재 시각이 기록되며, 목록에서 사라진다

### AC-306: 리마인더에서 메시지 생성

**Given** 재진 리마인더 카드에서
**When** [메시지생성] 버튼을 클릭하면
**Then** /messages 페이지로 이동하며, 해당 환자와 재진 메시지 유형이 자동 선택된다

### AC-307: 재진 환자 중복 리마인더 방지

**Given** 재진여부가 "재진O"이고 해당 재진 방문이 완료된 환자에 대해
**When** 리마인더 생성 로직이 실행되면
**Then** 해당 환자에 대한 중복 안부 리마인더는 생성되지 않는다

---

## 4. 모듈 4: 통계 대시보드

### AC-401: 월별 통계

**Given** 2026-02 월에 신환 45명, 재진 23명이 등록되어 있을 때
**When** 통계 페이지에서 2026-02를 선택하면
**Then** 신환 45명, 재진 23명, 총 68명이 표시된다

### AC-402: 진료과목별 통계

**Given** 기간을 2026-01 ~ 2026-02로 선택했을 때
**When** 진료과목 탭을 선택하면
**Then** 외과/내과/안과/치과/피부과/예방의학과/건강검진/기본검진/기본관리/재활/기타별 환자 수와 매출이 테이블과 차트로 표시된다

### AC-403: 내원경로별 통계

**Given** 기간을 선택한 상태에서
**When** 내원경로 탭을 선택하면
**Then** 인터넷/지인/기타/미작성별 환자 수와 매출이 바 차트로 시각화된다

### AC-404: 매출 통계

**Given** 기간 내 총 매출이 24,000,000원, 30만원 이상 고객이 32.5%일 때
**When** 전체 요약 탭을 확인하면
**Then** 총 매출 "2,400만", 30만원 이상 비율 "32.5%"가 카드에 표시된다

### AC-405: 기간 필터

**Given** 통계 페이지에서
**When** 기간을 2025-06 ~ 2025-12로 변경하고 [조회]를 클릭하면
**Then** 모든 탭의 통계가 해당 기간 데이터로 재계산되어 표시된다

### AC-406: 건강검진 프로모션 현황

**Given** health_checkups 테이블에 데이터가 존재할 때
**When** 건강검진 탭을 선택하면
**Then** 강아지/고양이별 신청 수, 검진종류별 분포, 매출 현황이 표시된다

---

## 5. 비기능 요구사항

### AC-501: 응답 속도

**Given** 1,000건 이상의 환자 데이터가 DB에 존재할 때
**When** /patients 페이지에 접속하면
**Then** 2초 이내에 페이지가 로딩되고 데이터가 표시된다

**Given** 검색어를 입력했을 때
**When** 엔터를 누르면
**Then** 1초 이내에 검색 결과가 표시된다

### AC-502: Excel 파싱 성능

**Given** 30개 시트, 총 3,000행의 데이터가 포함된 Excel 파일을
**When** 업로드하면
**Then** 10초 이내에 파싱이 완료되고 진행률 표시가 제공된다

### AC-503: 데이터 보안

**Given** 시스템이 운영 중일 때
**When** 브라우저 콘솔 또는 서버 로그를 확인하면
**Then** 보호자 성함, 연락처 등 개인정보가 평문으로 노출되지 않는다

### AC-504: 반응형 디자인

**Given** 1280px 이상 데스크톱 화면에서
**When** 모든 페이지를 탐색하면
**Then** 레이아웃이 깨지지 않고 정상 동작한다

**Given** 768px 이상 태블릿 화면에서
**When** 모든 페이지를 탐색하면
**Then** 사이드바가 접히고 메인 콘텐츠가 전체 너비를 차지하며 정상 동작한다

---

## 6. 품질 게이트 (Quality Gates)

| 항목 | 기준 |
|------|------|
| EARS 준수 | 모든 요구사항이 EARS 패턴으로 작성됨 |
| 테스트 커버리지 | 핵심 비즈니스 로직 (파싱, 메시지 생성, 리마인더) 85% 이상 |
| TypeScript strict | tsconfig.json strict: true |
| 린트 | ESLint 에러 0건 |
| 빌드 | next build 성공 |
| 접근성 | shadcn/ui 기본 접근성 준수 |

---

## 7. 완료 정의 (Definition of Done)

- [ ] 모든 REQ-xxx 요구사항이 구현됨
- [ ] 모든 AC-xxx 인수 기준을 통과함
- [ ] Excel 파일 업로드 및 파싱이 정상 동작함
- [ ] 7종 메시지 템플릿 생성 및 클립보드 복사가 동작함
- [ ] 리마인더 자동 생성 및 완료 추적이 동작함
- [ ] 통계 대시보드의 모든 탭이 정상 데이터를 표시함
- [ ] TypeScript strict 모드에서 빌드 성공
- [ ] Vercel 배포 성공
